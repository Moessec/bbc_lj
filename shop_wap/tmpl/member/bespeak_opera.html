<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,minimum-scale=1" />
    <title>报修预约</title>
    <link rel="stylesheet" type="text/css" href="../../css/base.css">
    <link rel="stylesheet" type="text/css" href="../../css/nctouch_member.css">
    <link rel="stylesheet" type="text/css" href="../../css/nctouch_common.css">
</head>

<body>
    <header id="header">
        <div class="header-wrap">
            <div class="header-l">
                <a href="bespeak_list.html"> <i class="back"></i> </a>
            </div>
            <div class="header-title">
                <h1>预约报修</h1>
            </div>
            <div class="header-r"> <a id="header-nav" href="javascript:void(0);"><i class="save"></i></a> </div>
        </div>
    </header>
    <div class="nctouch-main-layout">
        <form>
            <div class="nctouch-inp-con">
                <ul class="form-box">
                    <li class="form-item">
                        <h4>报修人</h4>
                        <div class="input-box">
                            <input type="text" class="inp" name="true_name" id="true_name" autocomplete="off" oninput="writeClear($(this));" />
                            <span class="input-del"></span> </div>
                    </li>
                    <li class="form-item">
                        <h4>联系方式</h4>
                        <div class="input-box">
                            <input type="tel" class="inp" name="usercontact" id="usercontact" autocomplete="off" oninput="writeClear($(this));" />
                            <span class="input-del"></span> </div>
                    </li>
                    <li class="form-item">
                        <h4>地区选择</h4>
                        <div class="input-box">
                            <input name="area_info" type="text" class="inp" id="area_info" autocomplete="off" onchange="btn_check($('form'));" readonly/>
                        </div>
                    </li>
                    <li class="form-item">
                        <h4>详细地址</h4>
                        <div class="input-box">
                            <input type="text" class="inp" name="address" id="address" autocomplete="off" oninput="writeClear($(this));">
                            <span class="input-del"></span> </div>
                    </li>
                    <li class="form-item">
                        <h4>报修物品</h4>
                        <div class="input-box">
                            <input type="tel" class="inp" name="bespeak_title" id="bespeak_title" autocomplete="off" oninput="writeClear($(this));" />
                            <span class="input-del"></span>
                        </div>
                    </li>
                    <li class="form-item">
                        <h4>报修详情</h4>
                        <div class="input-box">
                            <input type="tel" class="inp" name="bespeak_com" id="bespeak_com" autocomplete="off" oninput="writeClear($(this));" />
                            <span class="input-del"></span>
                        </div>
                    </li>
                    <li class="form-item">
                      <style>
                        .txt{ height:28px; border:1px solid #cdcdcd; width:670px;    font-size: 1rem;margin-left: 40px}
                        .mybtn{ background-color:#FFF; line-height:14px;vertical-align:middle;border:1px solid #CDCDCD;height:30px; width:70px;    font-size: 1rem;margin-left: 40px}
                        .file{ position:absolute; top:0;    font-size: 0.6rem; right:80px; height:24px; filter:alpha(opacity:0);opacity: 0;width:260px }
                    </style>
                    </head>
                    <body>
                    <div class="form-group">
                        <label class="control-label" style=" padding-left:12px;   font-size: 0.6rem;">图片上传：</label>
                        <span onclick="file.click()" style="font-size: 0.6rem;"  class="mybtn">浏览...</span>
                        <input type="file" name="file" class="file" id="file" size="28"  onchange="javascript:setImagePreview();" />
                        <span onclick="UpladFile()" id="upload" style="font-size: 0.6rem;" class="mybtn">上传</span>
                        <div class="input-box" style="display:none">
                            <input type="tel" class="inp" name="img" id="img" autocomplete="off" oninput="writeClear($(this));" />
                            <span class="input-del"></span>
                        </div>
                        <div id="localImag"><img id="preview" src="" width="150" height="180" style="display: block; width: 150px; height: 180px;"></div>
                  </li>
                </ul>
                <div class="error-tips"></div>
                <div class="form-btn"><a class="btn" href="javascript:;">申请报修</a></div>
            </div>
        </form>
    </div>
    <script type="text/javascript">
    var xhr;
    function createXMLHttpRequest()
    {
        if(window.ActiveXObject)
        {
            xhr = new ActiveXObject("Microsoft.XMLHTTP");
        }
        else if(window.XMLHttpRequest)
        {
            xhr = new XMLHttpRequest();
        }
    }
    function UpladFile()
    {
        var fileObj = document.getElementById("file").files[0];
        var FileController = ApiUrl + "/index.php?ctl=Buyer_Bespeak&met=upload&typ=json";
        var form = new FormData();
        form.append("myfile", fileObj);
        createXMLHttpRequest();
        xhr.onreadystatechange = handleStateChange;
        xhr.open("post", FileController, true);
        xhr.send(form);
    }
    function handleStateChange()
    {
        if(xhr.readyState == 4)
        {
            if (xhr.status == 200 || xhr.status == 0)
            {
                var result = xhr.responseText;
                var json = eval("(" + result + ")");
                var img = document.getElementById('img');
                alert(img);
                var val = img.value
                img.value=json.file+'--'+val;
                alert("上传成功，如有需要可以继续上传");
            }
        }
    }


function setImagePreview(avalue) {
    var docObj=document.getElementById("file");
     
    var imgObjPreview=document.getElementById("preview");
    if(docObj.files &&docObj.files[0])
    {
    //火狐下，直接设img属性
        imgObjPreview.style.display = 'block';
        imgObjPreview.style.width = '150px';
        imgObjPreview.style.height = '180px'; 
        //imgObjPreview.src = docObj.files[0].getAsDataURL();
         
        //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式
        imgObjPreview.src = window.URL.createObjectURL(docObj.files[0]);
    }
    else
    {
    //IE下，使用滤镜
    docObj.select();
    var imgSrc = document.selection.createRange().text;
    var localImagId = document.getElementById("localImag");
    //必须设置初始大小
    localImagId.style.width = "150px";
    localImagId.style.height = "180px";
    //图片异常的捕捉，防止用户修改后缀来伪造图片
        try{
            localImagId.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
            localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
        }
        catch(e)
        {
            alert("您上传的图片格式不正确，请重新选择!");
            return false;
        }
            imgObjPreview.style.display = 'none';
            document.selection.empty();
        }
    return true;
}
</script>
    <footer id="footer" class="bottom"></footer>
    <script type="text/javascript" src="../../js/zepto.min.js"></script>
    <script type="text/javascript" src="../../js/config.php"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <script type="text/javascript" src="../../js/simple-plugin.js"></script>
    <script type="text/javascript" src="../../js/tmpl/footer.js"></script>
    <script type="text/javascript" src="../../js/tmpl/bespeak_opera.js"></script>
</body>

</html>